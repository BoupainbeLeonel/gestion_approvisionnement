{% extends 'base.html.twig' %}

{% block title %}Approvisionnements{% endblock %}

{% block body %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Gestion des Approvisionnements</h2>
    <a href="{{ path('app_approvisionnement_new') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Nouvel approvisionnement
    </a>
</div>

{# SECTION FILTRES #}
<div class="card p-3 mb-4">
    <div class="row g-3">
        <div class="col-md-3">
            <input type="text" class="form-control" placeholder="Rechercher...">
        </div>
        <div class="col-md-3">
            <select class="form-select"><option>Tous les fournisseurs</option></select>
        </div>
        <div class="col-md-3">
            <select class="form-select"><option>Tous les articles</option></select>
        </div>
        <div class="col-md-3">
            <button class="btn btn-primary w-100"><i class="fas fa-filter"></i> Filtrer</button>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-body p-0">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th class="ps-4">Référence</th>
                    <th>Date</th>
                    <th>Fournisseur</th>
                    <th>Articles</th>
                    <th>Montant total</th>
                    <th>Statut</th>
                    <th class="text-end pe-4">Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for approvisionnement in approvisionnements %}
                <tr>
                    <td class="ps-4 fw-bold text-dark">{{ approvisionnement.reference }}</td>
                    
                    <td>{{ approvisionnement.date ? approvisionnement.date|date('d/m/Y') : '' }}</td>
                    
                    <td>
                        {% if approvisionnement.fournisseur %}
                            {{ approvisionnement.fournisseur.nom }}
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>

                    <td>
                        <span class="badge bg-info text-dark rounded-pill" style="background-color: #0dcaf0 !important; color: white !important; font-weight: 600;">
                            {{ approvisionnement.articles|length }} articles
                        </span>
                    </td>
                    
                    <td class="fw-bold">{{ approvisionnement.montantTotal|number_format(0, '.', ' ') }} FCFA</td>
                    
                    <td>
                        {% if approvisionnement.statut == 'Reçu' or approvisionnement.statut == 'Validé' %}
                            <span class="badge bg-success rounded-pill" style="background-color: #198754 !important;">Reçu</span>
                        {% elseif approvisionnement.statut == 'En attente' %}
                            <span class="badge bg-warning text-dark rounded-pill" style="background-color: #ffc107 !important;">En attente</span>
                        {% else %}
                            <span class="badge bg-secondary rounded-pill">{{ approvisionnement.statut }}</span>
                        {% endif %}
                    </td>
                    
                    <td class="text-end pe-4">
                        <div class="d-flex justify-content-end gap-1">
                            <a href="{{ path('app_approvisionnement_show', {'id': approvisionnement.id}) }}" class="btn btn-primary btn-sm px-2" title="Voir">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="{{ path('app_approvisionnement_edit', {'id': approvisionnement.id}) }}" class="btn btn-warning btn-sm text-white px-2" title="Modifier">
                                <i class="fas fa-pen"></i>
                            </a>
                            <form method="post" action="{{ path('app_approvisionnement_delete', {'id': approvisionnement.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ?');" style="display:inline-block;">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ approvisionnement.id) }}">
                                <button class="btn btn-danger btn-sm px-2" title="Supprimer">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="7" class="text-center py-4">Aucun approvisionnement trouvé</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="d-flex justify-content-center mb-5">
    <nav aria-label="Page navigation">
        <ul class="pagination">
            <li class="page-item disabled">
                <span class="page-link text-dark border-0 rounded-start" style="background-color: #e9ecef;">Précédent</span>
            </li>
            <li class="page-item active">
                <span class="page-link border-0" style="background-color: #0d6efd;">1</span>
            </li>
            <li class="page-item">
                <a class="page-link text-primary border-0" href="#">2</a>
            </li>
            <li class="page-item">
                <a class="page-link text-primary border-0" href="#">3</a>
            </li>
            <li class="page-item">
                <a class="page-link text-primary border-0 rounded-end" href="#">Suivant</a>
            </li>
        </ul>
    </nav>
</div>

<div class="row mt-4">
    <div class="col-md-4">
        <div class="card p-3 border-0 shadow-sm">
            <small class="text-muted">Total des approvisionnements</small>
            <h3 class="text-primary fw-bold mt-2">2 720 000 FCFA</h3>
            <small class="text-muted">Période: Avril 2023</small>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card p-3 border-0 shadow-sm">
            <small class="text-muted">Nombre d'approvisionnements</small>
            <h3 class="text-success fw-bold mt-2">{{ approvisionnements|length }}</h3>
            <small class="text-muted">Période: Avril 2023</small>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card p-3 border-0 shadow-sm">
            <small class="text-muted">Fournisseur principal</small>
            <h3 class="text-info fw-bold mt-2">Tech Solutions</h3>
            <small class="text-muted">1 430 000 FCFA (52.5%)</small>
        </div>
    </div>
</div>

{% endblock %}